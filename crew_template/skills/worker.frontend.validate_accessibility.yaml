# =============================================================================
# Skill: Worker Frontend Validate Accessibility - VTID-01164
# =============================================================================
# Catches missing aria labels, keyboard nav traps, non-semantic elements.
# Static checks in changed HTML/JS templates for common a11y issues.
# =============================================================================

skill_id: worker.frontend.validate_accessibility
name: Validate Accessibility
description: |
  Static accessibility checks in changed HTML/JS templates. Catches missing
  aria-label on icon-only buttons, role usage issues, tabIndex misuse, and
  other common a11y violations. Does not compute contrast ratios.
version: 1.0.0
category: worker
domain: frontend
vtid: VTID-01164

provider:
  type: internal
  module: services/agents/workforce/skills/validateAccessibility
  function: validateAccessibility
  timeout_ms: 30000

parameters:
  vtid:
    type: string
    required: true
    description: Task identifier
    pattern: "^VTID-\\d{4,}$"

  target_paths:
    type: array
    required: true
    description: File paths to check for accessibility issues
    items:
      type: string
    examples:
      - ["services/gateway/src/frontend/command-hub/app.js"]
      - ["services/gateway/src/frontend/**/*.html"]

  diff_content:
    type: string
    required: false
    description: Git diff content to check (alternative to file paths)

  severity_threshold:
    type: string
    required: false
    default: warning
    description: Minimum severity to report
    enum:
      - error
      - warning
      - info

  checks:
    type: array
    required: false
    description: Specific accessibility checks to run
    items:
      type: string
      enum:
        - aria_labels
        - keyboard_nav
        - semantic_elements
        - tab_order
        - focus_visible
        - alt_text
        - heading_order
        - form_labels
    default:
      - aria_labels
      - keyboard_nav
      - semantic_elements
      - tab_order

response_schema:
  ok:
    type: boolean
    description: Whether validation completed successfully

  passed:
    type: boolean
    description: Whether all checks passed (no errors)

  issues:
    type: array
    description: Accessibility issues found
    items:
      type: object
      properties:
        id:
          type: string
        severity:
          type: string
          enum: [error, warning, info]
        category:
          type: string
        file_path:
          type: string
        line_number:
          type: integer
        element:
          type: string
        issue:
          type: string
        recommendation:
          type: string
        wcag_ref:
          type: string

  summary:
    type: object
    properties:
      total_issues:
        type: integer
      errors:
        type: integer
      warnings:
        type: integer
      info:
        type: integer
      files_checked:
        type: integer
      elements_analyzed:
        type: integer

  checks_performed:
    type: array
    description: List of checks that were run
    items:
      type: string

  error:
    type: string
    description: Error message if validation failed

guardrails:
  # Only check frontend paths
  allowed_paths:
    - "services/gateway/src/frontend/**"
    - "services/gateway/dist/frontend/**"

  # Don't check backend
  forbidden_paths:
    - "services/gateway/src/routes/**"
    - "services/gateway/src/services/**"
    - "supabase/**"

  # CSP compliance (from frontend agent)
  csp_compliance: true

telemetry:
  emit_events: true
  event_types:
    - vtid.stage.worker_frontend.a11y_validate.start
    - vtid.stage.worker_frontend.a11y_validate.success
    - vtid.stage.worker_frontend.a11y_validate.failed
    - vtid.stage.worker_frontend.a11y_validate.issue
  oasis_endpoint: ${OASIS_API_URL}/events/ingest
  include_metadata:
    - files_checked
    - total_issues
    - severity_breakdown

usage:
  roles:
    - worker
    - validator
  primary_role: worker
  use_cases:
    - Validate UI changes for accessibility
    - Pre-merge a11y gate
    - Audit existing frontend code
    - Ensure WCAG compliance

error_handling:
  retry_attempts: 1
  retry_backoff_ms: 1000
  fallback_strategy: return_error_with_details

  error_codes:
    FILE_NOT_FOUND:
      description: Target file does not exist
      recoverable: false

    PARSE_ERROR:
      description: Could not parse HTML/JS for analysis
      recoverable: false

    NO_FRONTEND_CONTENT:
      description: No frontend content found in specified paths
      recoverable: false
